<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>POSTURE ENFORCER</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0d0d0d;
      --fg: #f4f4f4;
      --accent: #facc15;
    }

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      transition: background-color 0.2s, color 0.2s;
      position: relative;
      overflow: hidden;
      font-size: 4vw;
      min-font-size: 12px;
    }

    @media (max-width: 400px) {
      body, html {
        font-size: 14px !important;
      }
    }

    @media (min-width: 1200px) {
      body, html {
        font-size: 18px !important;
      }
    }

    h1, h2 {
      margin: 0.5rem;
      text-align: center;
      z-index: 1;
      position: relative;
      font-size: 2.5em;
    }

    button {
      font-size: 1em;
      padding: 0.75rem 1.25rem;
      margin: 0.5rem;
      border: none;
      border-radius: 0.5rem;
      background-color: var(--accent);
      color: #000;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      z-index: 1;
      position: relative;
      min-width: 6em;
      max-width: 90vw;
      word-break: break-word;
    }

    button:hover {
      transform: scale(1.05);
      background-color: #ffe53b;
    }

    /* Fix countdown container width to avoid jitter */
    #countdown {
      margin-top: 1rem;
      font-size: 1.25em;
      opacity: 0.8;
      z-index: 1;
      position: relative;
      max-width: 90vw;
      text-align: center;
      word-break: break-word;
      width: 10ch;  /* fixed width to fit mm:ss nicely */
      min-width: 10ch;
      /* horizontally center */
      margin-left: auto;
      margin-right: auto;
    }

    #soundDisplay {
      margin-top: 1rem;
      font-size: 1.1em;
      text-align: center;
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      z-index: 1;
      max-width: 90vw;
      padding: 0 1vw;
      word-break: break-word;
    }

    #epilepsyWarning {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: red;
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 0.25rem;
      font-size: 0.7em;
      font-weight: bold;
      z-index: 9999;
      user-select: none;
      max-width: 90vw;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #intervalModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 1vw;
    }

    #intervalContent {
      background: var(--bg);
      padding: 2rem 2.5rem;
      border-radius: 1rem;
      text-align: center;
      color: var(--fg);
      box-shadow: 0 0 15px var(--accent);
      max-width: 400px;
      width: 100%;
      font-size: 1rem;
    }

    #intervalInput {
      width: 100%;
      font-size: 1.2rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: none;
      outline: none;
      text-align: center;
      margin-bottom: 1.5rem;
      color: #000;
      max-width: 100%;
    }

    #intervalSubmit {
      background-color: #333;
      border: none;
      color: white;
      font-size: 1.5rem;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1rem;
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
    }

    #intervalSubmit:hover {
      background-color: #444;
    }

    .sfx-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1rem;
      gap: 0.5rem;
    }

    .sfx-buttons button {
      font-size: 0.85rem;
      flex: 1 1 120px;
      max-width: 40vw;
      min-width: 100px;
      padding: 0.5rem 0.75rem;
      word-break: break-word;
    }

    #flashOverlay {
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: 9998;
      background-color: black;
      color: yellow;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      animation: flashBG 0.25s infinite;
      font-size: 5vw;
      text-align: center;
      padding: 2vw;
      box-sizing: border-box;
    }

    #flashOverlay.flashing * {
      animation: flashText 0.25s infinite;
      border-color: currentColor !important;
      pointer-events: auto;
      cursor: pointer;
    }

    @keyframes flashBG {
      0%, 100% { background-color: black; color: yellow; }
      50%      { background-color: yellow; color: black; }
    }

    @keyframes flashText {
      0%, 100% {
        background-color: black !important;
        color: yellow !important;
        border-color: yellow !important;
      }
      50% {
        background-color: yellow !important;
        color: black !important;
        border-color: black !important;
      }
    }

    /* Ripple Effect Styles */
    .ripple {
      position: fixed;
      width: 30px;
      height: 30px;
      background: var(--accent);
      border-radius: 50%;
      pointer-events: none;
      transform: scale(0);
      animation: rippleEffect 0.5s ease-out forwards;
      z-index: 9999;
      opacity: 0.6;
    }

    @keyframes rippleEffect {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="epilepsyWarning" title="Warning: Photosensitive epilepsy risk">âš  PHOTOSENSITIVE EPILEPSY WARNING</div>

  <button id="startButton" style="display:none;">Start Posture Watch</button>
  <div id="countdown"></div>
  <div id="soundDisplay">Sound Selected: Metal Pipe</div>

  <div id="flashOverlay">
    <h1>CHECK YOUR POSTURE</h1>
    <button id="confirmButtonOverlay">I Fixed My Posture</button>
  </div>

  <audio id="alertSound" loop></audio>
  <audio id="popSound" src="pop_7e9Is8L.mp3"></audio>

  <div id="intervalModal">
    <div id="intervalContent">
      <label for="intervalInput">Set reminder interval (minutes):</label>
      <input type="number" id="intervalInput" min="1" max="180" value="15" />

      <h3 style="margin-top: 1rem;">Choose Your Sound:</h3>
      <div class="sfx-buttons" id="soundButtons"></div>

      <button id="intervalSubmit">Set Timer</button>
    </div>
  </div>

  <script>
    const sfxOptions = {
      "Among Us": "among-us-role-reveal-sound.mp3",
      "Wow!": "anime-wow-sound-effect.mp3",
      "Discord": "discord-notification.mp3",
      "Fart": "dry-fart.mp3",
      "Metal Pipe": "metal-pipe-clang.mp3",
      "Nintendo Startup": "nintendo-game-boy-startup.mp3",
      "Pew Pew": "pew_pew-dknight556-1379997159.mp3",
      "Rizz SFX": "rizz-sound-effect.mp3",
      "Spongebob Fail": "spongebob-fail.mp3",
      "Vine Boom": "vine-boom.mp3",
      "You Like Femboys": "you-like-femboys.mp3"
    };

    let selectedSound = sfxOptions["Metal Pipe"];
    let selectedLabel = "Metal Pipe";
    let previewAudio = new Audio();
    let previewPlaying = false;
    let clickPopActive = false;

    const startButton = document.getElementById("startButton");
    const flashOverlay = document.getElementById("flashOverlay");
    const alertSound = document.getElementById("alertSound");
    const popSound = document.getElementById("popSound");
    const countdownDisplay = document.getElementById("countdown");
    const soundDisplay = document.getElementById("soundDisplay");
    const intervalModal = document.getElementById("intervalModal");
    const intervalInput = document.getElementById("intervalInput");
    const intervalSubmit = document.getElementById("intervalSubmit");
    const confirmButtonOverlay = document.getElementById("confirmButtonOverlay");
    const soundButtonsContainer = document.getElementById("soundButtons");

    let nextTriggerTime;
    let countdownInterval;
    let REMINDER_INTERVAL_MS;

    for (let [label, file] of Object.entries(sfxOptions)) {
      const btn = document.createElement("button");
      btn.textContent = label;

      btn.onclick = () => {
        selectedSound = file;
        selectedLabel = label;
        alertSound.src = selectedSound;
        soundDisplay.textContent = `Sound Selected: ${label}`;

        [...soundButtonsContainer.children].forEach(b => b.style.background = "var(--accent)");
        btn.style.background = "#4ade80";

        if (previewPlaying) {
          previewAudio.pause();
          previewAudio.currentTime = 0;
        }

        previewAudio = new Audio(file);
        previewAudio.play();
        previewPlaying = true;

        previewAudio.onended = () => {
          previewPlaying = false;
        };
      };

      soundButtonsContainer.appendChild(btn);
    }

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');
      return `${minutes}:${seconds}`;
    }

    function updateCountdown() {
      const now = Date.now();
      const remaining = nextTriggerTime - now;

      if (remaining <= 0) {
        countdownDisplay.textContent = "00:00";
        clearInterval(countdownInterval);
        triggerReminder();
      } else {
        countdownDisplay.textContent = `Next reminder in ${formatTime(remaining)}`;
      }
    }

    function scheduleReminder() {
      nextTriggerTime = Date.now() + REMINDER_INTERVAL_MS;
      updateCountdown();
      countdownInterval = setInterval(updateCountdown, 500);
      clickPopActive = true;
    }

    function triggerReminder() {
      alertSound.play();
      flashOverlay.style.display = "flex";
      flashOverlay.classList.add("flashing");
    }

    function stopReminder() {
      alertSound.pause();
      alertSound.currentTime = 0;
      flashOverlay.style.display = "none";
      flashOverlay.classList.remove("flashing");
      scheduleReminder();
    }

    intervalSubmit.addEventListener("click", () => {
      let val = parseInt(intervalInput.value, 10);
      if (isNaN(val) || val < 1 || val > 180) {
        alert("Please enter a valid number between 1 and 180.");
        return;
      }
      REMINDER_INTERVAL_MS = val * 60 * 1000;
      intervalModal.style.display = "none";
      startButton.style.display = "inline-block";

      if (previewPlaying) {
        previewAudio.pause();
        previewAudio.currentTime = 0;
        previewPlaying = false;
      }

      popSound.play();
    });

    startButton.addEventListener("click", () => {
      startButton.style.display = "none";
      scheduleReminder();
      popSound.play();
    });

    confirmButtonOverlay.addEventListener("click", stopReminder);

    window.addEventListener("click", (e) => {
      if (clickPopActive) {
        popSound.currentTime = 0;
        popSound.play();
      }

      const ripple = document.createElement("div");
      ripple.className = "ripple";
      document.body.appendChild(ripple);

      ripple.style.left = `${e.clientX - 15}px`;
      ripple.style.top = `${e.clientY - 15}px`;

      setTimeout(() => ripple.remove(), 500);
    });

    window.onload = () => {
      intervalModal.style.display = "flex";
    };
  </script>
</body>
</html>
